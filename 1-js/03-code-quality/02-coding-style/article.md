# Советы по стилю кода

Код должен быть максимально читаемым и понятным.

Это и есть искусство программирования - взять сложную задачу и решить её правильным способом с удобочитаемым оформлением. Для этого нужен _хороший стиль_ написания кода. В этой главе мы рассмотрим составляющие такого стиля.

## Синтаксис

Шпаргалка с правилами синтаксиса (подробнее смотрите ниже по тексту):

![](code-style.png)
<!--
```js
function pow(x, n) {
  let result = 1;

  for (let i = 0; i < n; i++) {
    result *= x;
  }

  return result;
}

let x = prompt("x?", "");
let n = prompt("n?", "");

if (n < 0) {
  alert(`Степень ${n} не поддерживается,
   введите целую степень, большую 0`);
} else {
  alert( pow(x, n) );
}
```

-->

Не всё здесь однозначно, так что разберём эти правила подробнее.

```warn header="Ирония"
Здесь нет железных правил. Это стилевые предпочтения, а не религиозные догмы.
```

### Фигурные скобки

В большинстве JavaScript проектов фигурные скобки пишутся в так называемом "египетском" стиле с открывающей скобкой на той же строке, что и соответствующее ключевое слово - не на новой строке. Перед открывающей скобкой должен быть пробел, как здесь:

```js
if (condition) {
  // делай это
  // ...и это
  // ...и потом это
}
```

Запись в одну строку - на крайний случай! Должны ли мы использовать скобки вообще? Если да, то где?

Ниже приведены некоторые варианты написания кода с примечаниями, чтобы вы могли оценить их читаемость самостоятельно:

<!--
```js no-beautify
if (n < 0) {alert(`Степень ${n} не поддерживается`);}

if (n < 0) alert(`Степень ${n} не поддерживается`);

if (n < 0)
  alert(`Степень ${n} не поддерживается`);

if (n < 0) {
  alert(`Степень ${n} не поддерживается`);
}
```
-->
![](figure-bracket-style.png)

В итоге:
- Для очень короткого кода допустима одна строка. Например: `if (cond) return null`.
- Но отдельная строка для каждого оператора в скобках обычно легче для восприятия.

### Длина строки

Никто не любит читать длинные горизонтальные строки кода. Лучше всего разбить их на части и ограничить длину строк.

Максимальную длину строки согласовывают в команде. Обычно это `80` или `120` символов.

### Отступы

Существует два типа отступов:

- **Горизонтальные отступы, при вложенности – два (или четыре) пробела.**

    Горизонтальный отступ выполняется с помощью 2 или 4 пробелов, или символа "Tab". Какой из них выбрать - это уже старый холивар. Пробелы более распространены в наши дни.

    Одно из преимуществ пробелов над тамбуляцией заключается в том, что пробелы допускают более гибкие конфигурации отступов, чем символ "Tab".

    Например, мы можем выровнять аргументы относительно открывающей скобки:

    ```js no-beautify
    show(parameters,
         aligned, // 5 пробелов слева  
         one,
         after,
         another
      ) {
      // ...
    }
    ```

- **Вертикальные отступы, для лучшей разбивки кода – перевод строки**

    Даже одну функцию часто можно разделить на логические блоки. В примере ниже разделены инициализация переменных, основной цикл и возвращаемый результат:

    ```js
    function pow(x, n) {
      let result = 1;
      //              <--
      for (let i = 0; i < n; i++) {
        result *= x;
      }
      //              <--
      return result;
    }
    ```

    Вставляйте дополнительный перевод строки туда, где это сделает код более читаемым. Не должно быть более 9 строк кода подряд без вертикального отступа.

### Точка с запятой

Точки с запятой должны присутствовать после каждого выражения, даже если их, казалось бы, можно пропустить.

Есть языки, в которых точка с запятой необязательна и редко используется. Однако в JavaScript бывают случаи, когда перенос строки не интерпретируется как точка с запятой, что делает код уязвимым к ошибкам.

Когда вы станете более зрелым программистом, вы можете выбрать стиль без точки с запятой, такой как в [StandardJS](https://standardjs.com/). До тех пор лучше использовать точку с запятой, чтобы избежать возможных подводных камней.

### Уровни вложенности

Уровней вложенности должно быть немного.

Иногда полезно использовать директиву ["continue"](info:while-for#continue) в цикле, чтобы избежать лишней вложенности.

Например, вместо добавления вложенного условия `if`, как это:

```js
for (let i = 0; i < 10; i++) {
  if (cond) {
    ... // <- ещё один уровень вложенности
  }
}
```

Используйте:

```js
for (let i = 0; i < 10; i++) {
  if (!cond) *!*continue*/!*;
  ...  // <- нет лишнего уровня вложенности
}
```

Аналогичная ситуация – с `if/else` и `return`.

Например, две нижеследующие конструкции идентичны.

Первая:

```js
function pow(x, n) {
  if (n < 0) {
    alert("Отрицательные значения 'n' не поддерживаются");
  } else {
    let result = 1;

    for (let i = 0; i < n; i++) {
      result *= x;
    }

    return result;
  }  
}
```

Вторая:

```js
function pow(x, n) {
  if (n < 0) {
    alert("Отрицательные значения 'n' не поддерживаются");
    return;
  }

  let result = 1;

  for (let i = 0; i < n; i++) {
    result *= x;
  }

  return result;
}
```

Второй вариант является более читабельным, потому что "крайний случай" `n < 0` обрабатывается на ранней стадии. После проверки можно переходить к "основному" потоку кода без необходимости дополнительного вложения.

## Размещение функций

Если вы пишете несколько "вспомогательных" функций и далее используемый ими код, то существует три способа организации функций.

1. Функции, объявленные над кодом, который их вызовет:

    ```js
    // *!*объявление функций*/!*
    function createElement() {
      ...
    }

    function setHandler(elem) {
      ...
    }

    function walkAround() {
      ...
    }

    // *!*код, который использует их*/!*
    let elem = createElement();
    setHandler(elem);
    walkAround();
    ```
2. Сначала код, затем функции

    ```js
    // *!*код, использующий функции*/!*
    let elem = createElement();
    setHandler(elem);
    walkAround();

    // --- *!*вспомогательные функции*/!* ---
    function createElement() {
      ...
    }

    function setHandler(elem) {
      ...
    }

    function walkAround() {
      ...
    }
    ```
3. Смешанный стиль: функция объявляется там, где она используется впервые.

В большинстве случаев второй вариант является предпочтительным.

Это потому, что при чтении кода мы сначала хотим знать, *что он делает*. Если сначала первым записан код, то он предоставляет эту информацию. Тогда, может быть, нам вообще не нужно будет читать функции, особенно если их имена описывают то, что они на самом деле выполняют.

## Руководства по стилю кода

Руководство по стилю содержит общие правила о том, как писать код, например: какие кавычки использовать, сколько пробелов отступать, куда помещать разрывы строк и так далее - в общем, множество мелочей.

Когда все участники команды используют одно и то же руководство по стилю, код выглядит одинаково, независимо от того, кто из команды его написал.

Конечно, команда всегда может написать собственное руководство по стилю. Хотя в большинстве случаев в этом нет необходимости. Существует множество проверенных и верных вариантов на выбор, поэтому использование одного из них, как правило, будет лучшим вариантом.

Большинство есть на английском, сообщите мне, если найдёте хороший перевод:

- [Google JavaScript Style Guide](https://google.github.io/styleguide/javascriptguide.xml)
- [Airbnb JavaScript Style Guide](https://github.com/airbnb/javascript) (есть [перевод](https://leonidlebedev.github.io/javascript-airbnb/))
- [Idiomatic.JS](https://github.com/rwaldron/idiomatic.js) (есть [перевод](https://github.com/leonidlebedev/javascript-airbnb))
- [Стандартный стиль JavaScript](https://standardjs.com/)
- (и ещё множество других)

Если вы начинающий разработчик, то начните со шпаргалки в начале этой главы. Как только вы освоитесь, просмотрите другие руководства, чтобы выбрать общие принципы и решить, какой из них вам больше подходит.

## Автоматизированные средства проверки (линтеры)

Линтеры - это инструменты, которые могут автоматически проверять стиль вашего кода и вносить предложения по рефакторингу.

Самое замечательное в них то, что проверка стиля может также найти некоторые ошибки, такие как опечатки в именах переменных или функций. Из-за этой особенности установка средства проверки рекомендуется, даже если вы не хотите придерживаться одного конкретного "стиля кода".

Вот самые известные инструменты для проверки:

- [JSLint](http://www.jslint.com/) -- проверяет код на соответствие [стилю JSLint](http://www.jslint.com/lint.html), в онлайн-интерфейсе вверху можно ввести код, а внизу различные настройки проверки, чтобы сделать её более мягкой.
- [JSHint](http://www.jshint.com/) -- вариант JSLint с большим количеством настроек.
- [ESLint](http://eslint.org/) -- наверное, самый новый.

Все они выполняют свою работу. Автор пользуется [ESLint](http://eslint.org/).

Большинство линтеров интегрированы со многими популярными редакторами: просто включите плагин в редакторе и настройте стиль.

Например, для ESLint вы должны выполнить следующее:

1. Установите [Node.JS](https://nodejs.org/).
2. Установите ESLint с помощью команды `npm install -g eslint` (npm - установщик пакетов JavaScript).
3. Создайте файл конфигурации с именем `.eslintrc` в корне вашего JavaScript-проекта (в папке, содержащей все ваши файлы).
4. Установите/включите плагин для вашего редактора, который интегрируется с ESLint. У большинства редакторов он есть.

Вот пример файла `.eslintrc`:

```js
{
  "extends": "eslint:recommended",
  "env": {
    "browser": true,
    "node": true,
    "es6": true
  },
  "rules": {
    "no-console": 0,
  },
  "indent": 2
}
```

Здесь директива `"extends"` означает, что конфигурация основана на наборе настроек "eslint:recommended". После этого мы уточняем наши собственные.

Кроме того, возможно загрузить наборы правил стиля из сети и расширить их. Смотрите <https://eslint.org/docs/user-guide/getting-started> для получения более подробной информации об установке.

Также некоторые среды разработки имеют встроенное средство проверки, что может быть удобно, но не так гибко в настройке, как ESLint.

## Итого

Все правила синтаксиса, описанные в этой главе (и в ссылках на руководства по стилю), направлены на повышение читаемости вашего кода, но все они спорны.

Когда мы думаем о написании "лучшего" кода, мы должны задать следующие вопросы: "Что делает код более читаемым и лёгким для понимания?" и "Что может нам помочь избегать ошибок". Это основные моменты, о которых следует помнить при выборе и обсуждении стилей кода.

Чтение популярных руководств по стилю позволит вам быть в курсе лучших практик и последних идей и тенденций в стилях написания кода.
