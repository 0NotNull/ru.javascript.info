# Код ниндзя

```quote author="Конфуций"
Напрасно обучение без мысли; мысль без обучения опасна.
```

Программисты-ниндзя прошлого использовали эти приёмы, чтобы очистить разум тех, кто будет поддерживать их код.

Гуру код-ревью ищут их в тестовых заданиях.

Программисты-новички иногда применяют их даже лучше, чем программисты-ниндзя.

Прочитайте их внимательно и решите, кто вы на самом деле -- ниндзя, новичок или ревьюер?

```warn header="Обнаружена ирония!"
Многие пытаются следовать путём ниндзя. У некоторых это получается.
```

## Краткость -- сестра таланта.

Делайте код настолько кратким, насколько это возможно. Покажите, насколько вы умны.

Позвольте тонким особенностям языка направлять вас.

Например, посмотрим на этот тернарный оператор `'?'`:

```js
// взято из хорошо известной javascript-библиотеки
i = i ? i < 0 ? Math.max(0, len + i) : i : 0;
```

Круто, да? Если вы так напишете, то разработчик, который потом наткнётся на эту строку и попытается понять, чему будет равно `i`, получит настоящее удовольствие. А затем придёт к вам за ответом.

Скажите ему, что чем короче, тем лучше. Всегда. Направьте его на путь ниндзя.

## Однобуквенные переменные

```quote author="Лао-цзы (Дао Дэ Цзин)"
Дао скрывается в отсутствии слов. Только Дао хорошо началось и хорошо закончилось.
```

Другой способ быстро писать код -- это повсюду использовать однобуквенные переменные. Например, `a`, `b` или `c`.

Переменная с коротким именем растворяется в коде как настоящий ниндзя в лесу. Никто не сможет найти её с помощью функции "поиска" в редакторе кода. А если найдёт, то не сможет расшифровать, что означает имя `a` или `b`.

...Но есть исключение. Настоящий ниндзя никогда не будет использовать `i` как счётчик в цикле `"for"`. Где угодно, но не в нём. Осмотритесь вокруг, есть много куда более экзотических букв. Например, `x` или `y`.

Экзотическая переменная в роли счётчика в цикле выглядит особенно круто, если тело цикла занимает 1-2 страницы (делайте его настолько длинным, насколько это возможно). Если кто-нибудь потом будет разбираться с этим циклом, то не сможет быстро сообразить, что переменная с именем `x` -- это счётчик цикла.

## Используйте сокращения

Если правила вашей команды запрещают использовать однобуквенные или абстрактные имена для переменных, то сокращайте их, придумывайте аббревиатуры.

Например, так:

- `list` -> `lst`.
- `userAgent` -> `ua`.
- `browser` -> `brsr`.
- ...и так далее.

Только тот, у кого действительно хорошая интуиция, сможет разобраться в этих именах. Сокращайте всё подряд. Только достойный человек сможет поддерживать ваш код.

## Парите над землёй. Будьте абстрактны

```quote author="Лао-цзы (Дао Дэ Цзин)"
Великий квадрат не имеет углов.
Большой сосуд долго изготовляется.
Сильнейший звук нельзя услышать.
Великий образ не имеет формы.
```

Выбирая имена переменным, используйте максимально абстрактные слова. Такие как `obj`, `data`, `value`, `item`, `elem` и так далее.

- **Идеальное имя для переменной -- `data` ("данные").** Используйте его везде, где только можно. В конце концов, каждая переменная содержит какие-то *данные*, так ведь?

    ...Но что делать, если имя `data` уже занято? Попробуйте `value` *("значение")*, оно не менее универсально. Ведь в каждую переменную записывается какое-либо *значение*.

- **Называйте переменную по её типу: `str`, `num`...**

    Дайте им шанс. Юный падаван может удивиться -- разве такие имена действительно полезны ниндзя? Да, полезны!

    Согласитесь, что такое имя переменной имеет чёткое назначение. Оно говорит о том, что находится внутри переменной: строка, число или что-то другое. Но когда человек со стороны попытается понять такой код, он удивится, не найдя никакой важной информации! И в итоге не сможет изменить ваш хорошо продуманный код.
    
    Тип переменной легко узнать во время отладки. Но в чём смысл переменной? Что за строка или число в ней хранится?
    
    В этом невозможно разобраться без хорошей медитации!

- **...Но что делать, если все подобные имена заняты?** Просто добавьте номер: `data1, item2, elem5`...

## Тест на внимание

Только по-настоящему внимательный программист сможет понять ваш код. Но как это проверить?

**Один из способов -- использовать похожие имена для переменных, например `date` и `data`.**

Смешивайте их везде, где сможете.

Быстрое чтение такого кода станет невозможным. А если будут опечатки... Хмм... Похоже, мы надолго застряли. Пойдёмте пить чай.

## Умные синонимы

```quote author="Конфуций"
Самая сложная в мире вещь -- найти чёрного кота в тёмной комнате, особенно если в ней нет кота.
```

Использование *похожих* имён для похожих *вещей* делает жизнь интереснее и даёт возможность продемонстрировать вашу креативность окружающим.

Для примера возьмём префиксы функций. Если функция выводит на экран сообщение, то начните её имя с `display...`, например, `displayMessage`. А если другая функция выводит на экран что-нибудь ещё, например, имя пользователя, используйте префикс `show...` (`showName`).

Намекните, что между этими функциями есть небольшая разница, когда на самом деле её нет.

Заключите соглашение с коллегами-ниндзя из вашей команды: если Иван называет "выводящие на экран" функции с `display...`, то Пётр может использовать `render...`, а Анна -- `paint...`. Обратите внимание, насколько интересным и разнообразным станет код.

...А теперь просто бомба!

Для двух функций, имеющих важные различия, используйте один и тот же префикс!

Например, функция `printPage(page)` будет использовать принтер. А функция `printText(text)` будет выводить текст на экран. Дайте стороннему читателю возможность хорошенько поразмыслить над третьей похожей функцией `printMessage`: "Куда она выведет сообщение? На принтер или на экран?" И, в качестве финального аккорда, сделайте так, чтобы `printMessage` выводила сообщение в новое окно!

## Используйте имена повторно

```quote author="Лао-цзы (Дао Дэ Цзин)"
Когда целое разделено, частям нужны имена.
Уже существует достаточно имен.
Мы должны знать, когда остановиться.
```

Добавляйте новые переменные только тогда, когда без этого вообще не обойтись.

Вместо этого используйте существующие имена. Просто записывайте в них новые значения.

В функциях старайтесь использовать только переменные, передаваемые как параметры.

Это усложнит работу, если кто-то захочет понять, что находится в этой переменной *сейчас*. И откуда это значение приходит. Человеку со слабой интуицией придётся анализировать код, строку за строкой, и отслеживать изменения в каждой ветке кода.

**Продвинутый вариант этой практики заключается в том, чтобы тайно (!) заменить значение чем-то похожим в середине цикла или функции.**

Например:

```js
function ninjaFunction(elem) {
  // 20 строк кода работаем с elem

  elem = clone(elem);

  // Ещё 20 строк, но работаем уже с клоном elem!
}
```

Ваш коллега, который захочет работать с `elem` во второй половине функции будет удивлён... Только во время отладки, после исследования кода он обнаружит, что работает с клоном!

Регулярно встречается в коде. Смертельно эффективно даже против опытных ниндзя. 

## Подчёркивания шутки ради

Используйте нижние подчёркивания `_` и `__` перед именами переменных. Например, `_name` или `__value`. Круто, если их значение понимаете только вы. Или, что ещё лучше, добавляйте их просто по приколу, без особой цели. Или пусть они имеют разное назначение в разных местах.

Вы убьёте двух зайцев одним выстрелом. Во-первых, код станет длиннее, и его будет сложнее читать, и, во-вторых, коллега-программист проведёт много времени, пытаясь понять, что означают ваши подчёркивания.

Умный ниндзя использует подчёркивания в одном месте кода и избегает их в других местах. Это делает код более хрупким и увеличивает вероятность возникновения ошибок в будущем.

## Покажите свою любовь

Позвольте всем увидеть, насколько богат ваш внутренний мир! Имена вроде `superElement`, `megaFrame` и `niceItem` определённо приведут читателя в восторг.

Действительно, с одной стороны, вы восторженно пишете: `super..`, `mega..`, `nice..` С другой стороны, это ничего толком не объясняет. Читатель решит искать скрытый смысл и будет медитировать час или два.

## Перекрывайте внешние переменные

```quote author="Гуанинь"
Будучи на свету, не можешь ничего увидеть в темноте.
Будучи в темноте, увидишь всё на свету.
```

Используйте одни и те же имена для переменных внутри и снаружи функции. Это просто. Никаких усилий.

```js
let *!*user*/!* = authenticateUser();

function render() {
  let *!*user*/!* = anotherValue();
  ...
  ...много строк...
  ...
  ... // <-- разработчик захочет поработать с user в этом месте и...
  ...
}
```

Программист, который будет изучать функцию `render`, вероятно, не заметит, что  здесь есть локальная переменная `user`, перекрывающая внешнюю.

Затем он попытается работать с `user`, предполагая, что это внешняя переменная, результат `authenticateUser()`... Ловушка захлопнулась! Привет, отладчик...

## Побочные эффекты повсюду!

Есть такие функции, которые выглядят так, словно они ничего не меняют. Например, `isReady()`, `checkPermission()`, `findTags()`... Предполагается, что они производят вычисления или ищут и возвращают данные, не меняя ничего снаружи. Другими словами, без "побочных эффектов". 

**Действительно прекрасный трюк - добавить в них "полезное" действие помимо основной задачи.**

Представьте ошеломлённые лица своих коллег, когда они увидят функцию с `is..`, `check..` или `find...` в названии, которая что-то изменяет -- это определённо раздвинет границы вашего разума.

**Другой способ удивить - это вернуть нестандартный результат.**

Продемонстрируйте необычность вашего мышления! Пусть вызов функции `checkPermission` возвращает не `true/false`, а комплексный объект с результатами проверки.

Те разработчики, которые попытаются написать `if (checkPermission(..))`, удивятся, почему это не работает. Ответьте им: "Читай документацию!" И покажите им эту статью.

## Могучие функции!

```quote author="Лао-цзы (Дао Дэ Цзин)"
Великий Дао течёт во всех направлениях,
И налево, и направо.
```

Не ограничивайте функцию тем, что указано в её имени. Мыслите шире.

Например, функция `validateEmail(email)` может (помимо проверки корректного ввода email) выдавать сообщение об ошибке и просить ввести email снова.

Дополнительные действия не должны быть очевидны исходя из имени функции. Более того, настоящий ниндзя-кодер спрячет их в код так, что не будет понятно, что они вообще есть.

**Объединение нескольких действий в одно защищает ваш код от повторного использования.**

Представьте, другой разработчик захочет просто проверить корректность адреса электронной почты и не выводить никакого сообщения. Ваша функция `validateEmail(email)`, которая делает и то, и другое, ему не подойдёт. Так что никто не прервёт вашу медитацию своими вопросами о ней.  

## Подведём итоги

Все наставления выше взяты из реального кода... Иногда написанного опытными разработчиками. Может быть даже более опытными, чем вы ;)

- Следуйте некоторым из них, и ваш код будет полон сюрпризов.
- Следуйте большинству из них, и ваш код будет только вашим, и никто не захочет его изменить.
- Следуйте всем, и ваш код станет ценным уроком для юных разработчиков, ищущих просветления.